#!/usr/bin/make -f

export DEB_BUILD_HARDENING=1
#export DH_VERBOSE=1
#export DH_OPTIONS=-v

#include /usr/share/cdbs/1/rules/debhelper.mk
#include /usr/share/cdbs/1/class/autotools.mk
#include /usr/share/cdbs/1/class/python-module.mk

%:
	dh $@ --with python2

override_dh_auto_configure:
	mv configure configure.dist && ./autogen.sh
	dh_auto_configure

override_dh_install:
	strip --remove-section=.comment --remove-section=.note --strip-unneeded \
		debian/tmp/usr/lib/*/glusterfs/*/xlator/debug/trace.so
	strip --remove-section=.comment --remove-section=.note --strip-unneeded \
		debian/tmp/usr/lib/*/glusterfs/*/xlator/debug/error-gen.so
	strip --remove-section=.comment --remove-section=.note --strip-unneeded \
		debian/tmp/usr/lib/*/glusterfs/*/xlator/debug/io-stats.so
	find debian/tmp/usr/lib -type f -name \*.la -exec sed 's/^dependency_libs/#dependency_libs/g' -i {} \;
	dh_install
	mv debian/glusterfs-common/usr/lib/python2.7/site-packages \
		debian/glusterfs-common/usr/lib/python2.7/dist-packages
	mv debian/glusterfs-common/usr/lib/*/pkgconfig/ \
		debian/glusterfs-common/usr/lib/
	/usr/bin/install -D -p -m 0744 extras/hook-scripts/S56glusterd-geo-rep-create-post.sh \
		debian/glusterfs-server/var/lib/glusterd/hooks/1/gsync-create/post/S56glusterd-geo-rep-create-post.sh

override_dh_installinit:
	dh_installinit -pglusterfs-client --no-start --name=mounting-glusterfs
	dh_installinit -pglusterfs-server

override_dh_builddeb:
	dh_builddeb -- -Zxz

override_dh_strip:
	dh_strip --dbg-package=glusterfs-dbg
